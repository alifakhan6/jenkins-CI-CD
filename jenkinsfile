pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                git url: 'https://github.com/alifakhan6/jenkins-CI-CD.git', branch: 'develop'
            }
        }
        stage('Clean Up') {
            steps {
                script {
                    // Stop and remove existing containers using port 8000
                    def containerId = sh(script: 'docker ps -q --filter "publish=8000"', returnStdout: true).trim()
                    if (containerId) {
                        echo "Stopping and removing existing container using port 8000..."
                        sh "docker stop ${containerId}"
                        sh "docker rm ${containerId}"
                    }
                }
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    // Build the Docker image
                    sh 'docker build . -t todo-app'
                }
            }
        }
        stage('Run Docker Container') {
            steps {
                script {
                    // Run the new container on port 8000
                    sh 'docker run -p 8000:8000 -d todo-app'
                    echo "Application is running on port 8000"
                }
            }
        }
    }
}
